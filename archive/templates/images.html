{% extends "template.html" %}

{% load el_pagination_tags %}
{% load filters %}

{% block ptitle %}Images : FRAM Archive {% endblock %}

{% block title_div %}
  <h1>
  {{ images.count }} images
  </h1>

  <p  class="mb-4">
  {% if request.GET.sr %}
    in <b>{{ request.GET.sr }}</b> deg around RA=<b>{{ request.GET.ra }}</b> Dec=<b>{{request.GET.dec }}</b>
  {% elif request.GET.ra or requesr.GET.dec %}
    containing RA=<b>{{ request.GET.ra }}</b> Dec=<b>{{request.GET.dec }}</b>
  {% endif %}

  <!--
  {% if request.GET.site and request.GET.site != 'all' %}
    site=<b>{{ request.GET.site }}</b>
  {% endif %}

  {% if request.GET.ccd and request.GET.ccd != 'all' %}
    ccd=<b>{{ request.GET.ccd }}</b>
  {% endif %}

  {% if request.GET.filter and request.GET.filter != 'all' %}
    filter=<b>{{ request.GET.filter }}</b>
  {% endif %}

  {% if request.GET.type and request.GET.type != 'all' %}
    type=<b>{{ request.GET.type }}</b>
  {% endif %}

  {% if request.GET.target and request.GET.target != 'all' %}
    target=<b>{{ request.GET.target }}</b>
  {% endif %}

  {% if request.GET.night1 or request.GET.night2 %}
    {% if request.GET.night1 %}<b>{{ request.GET.night1 }}</b><={% endif %}
    night
    {% if request.GET.night2 %}<=<b>{{ request.GET.night2 }}</b>{% endif %}

  {% endif %}

  {% if request.GET.night %}night=<b>{{ request.GET.night }}</b>{% endif %}
  -->

  </p>

{% endblock %}

{% block content %}

  <div class="row">

    {% if sites %}
      <nav class="mr-2">
        <ul class="pagination pagination-sm justify-content-center">
          <li class="page-item disabled"><span class="page-link">Sites:</span></li>
          {% for site in sites %}
            {% with text="site="|add:site.site %}
              <li class="page-item {% if request.GET.site == site.site %}active{% endif %}"><a class="page-link" href="?{{ request.GET|GET_remove:"site"|GET_append:text|GET_urlencode }}">{{ site.site }}</a></li>
            {% endwith %}
          {% endfor %}
          <li class="page-item  {% if not request.GET.site %}active{% endif %}"><a class="page-link" href="?{{ request.GET|GET_remove:"site"|GET_urlencode }}">All</a></li>
        </ul>
      </nav>
    {% endif %}

    {% if ccds %}
      <nav class="mr-2">
        <ul class="pagination pagination-sm justify-content-center">
          <li class="page-item disabled"><span class="page-link">CCDs:</span></li>
          {% for ccd in ccds %}
            {% with text="ccd="|add:ccd.ccd %}
              <li class="page-item {% if request.GET.ccd == ccd.ccd %}active{% endif %}"><a class="page-link" href="?{{ request.GET|GET_remove:"ccd"|GET_append:text|GET_urlencode }}">{{ ccd.ccd }}</a></li>
            {% endwith %}
          {% endfor %}
          <li class="page-item  {% if not request.GET.ccd %}active{% endif %}"><a class="page-link" href="?{{ request.GET|GET_remove:"ccd"|GET_urlencode }}">All</a></li>
        </ul>
      </nav>
    {% endif %}

    {% if request.GET.serial %}
      <span>
        <nav class="mr-2">
          <ul class="pagination pagination-sm justify-content-center">
            <li class="page-item disabled"><span class="page-link">Serial:</span></li>
            <li class="page-item active"><span class="page-link">{{ request.GET.serial }}</span></li>
            <li class="page-item"><a class="page-link" href="?{{ request.GET|GET_remove:"serial"|GET_urlencode }}"><i class="fa fa-close"></i></a></li>
          </ul>
        </nav>
      </span>
    {% endif %}

    {% if filters %}
      <nav class="mr-2">
        <ul class="pagination pagination-sm justify-content-center">
          <li class="page-item disabled"><span class="page-link">Filters:</span></li>
          {% for filter in filters %}
            {% with text="filter="|add:filter.filter %}
              <li class="page-item {% if request.GET.filter == filter.filter %}active{% endif %}"><a class="page-link" href="?{{ request.GET|GET_remove:"filter"|GET_append:text|GET_urlencode }}">{{ filter.filter }}</a></li>
            {% endwith %}
          {% endfor %}
          <li class="page-item  {% if not request.GET.filter %}active{% endif %}"><a class="page-link" href="?{{ request.GET|GET_remove:"filter"|GET_urlencode }}">All</a></li>
        </ul>
      </nav>
    {% endif %}

    {% if types %}
      <nav class="mr-2">
        <ul class="pagination pagination-sm justify-content-center">
          <li class="page-item disabled"><span class="page-link">Types:</span></li>
          {% for type in types %}
            {% with text="type="|add:type.type %}
              <li class="page-item {% if request.GET.type == type.type %}active{% endif %}"><a class="page-link" href="?{{ request.GET|GET_remove:"type"|GET_append:text|GET_urlencode }}">{{ type.type }}</a></li>
            {% endwith %}
          {% endfor %}
          <li class="page-item  {% if not request.GET.type %}active{% endif %}"><a class="page-link" href="?{{ request.GET|GET_remove:"type"|GET_urlencode }}">All</a></li>
        </ul>
      </nav>
    {% endif %}

    {% if request.GET.night %}
      <span>
        <nav class="mr-2">
          <ul class="pagination pagination-sm justify-content-center">
            <li class="page-item disabled"><span class="page-link">Night:</span></li>
            <li class="page-item active"><span class="page-link">{{ request.GET.night }}</span></li>
            <li class="page-item"><a class="page-link" href="?{{ request.GET|GET_remove:"night"|GET_urlencode }}"><i class="fa fa-close"></i></a></li>
          </ul>
        </nav>
      </span>
    {% endif %}

    {% if request.GET.night1 or request.GET.night2 %}
      <span>
        <nav class="mr-2">
          <ul class="pagination pagination-sm justify-content-center">
            {% if request.GET.night1 %}
              <li class="page-item active"><span class="page-link">{{ request.GET.night1 }}</span></li>
            {% endif %}
            <li class="page-item disabled"><span class="page-link">{% if request.GET.night1 %}<={% endif %}Night{% if request.GET.night2 %}<={% endif %}</span></li>
            {% if request.GET.night2 %}
              <li class="page-item active"><span class="page-link">{{ request.GET.night2 }}</span></li>
            {% endif %}
            <li class="page-item"><a class="page-link" href="?{{ request.GET|GET_remove:"night1"|GET_remove:"night2"|GET_urlencode }}"><i class="fa fa-close"></i></a></li>
          </ul>
        </nav>
      </span>
    {% endif %}

    {% if request.GET.target %}
      <span>
        <nav class="mr-2">
          <ul class="pagination pagination-sm justify-content-center">
            <li class="page-item disabled"><span class="page-link">Target:</span></li>
            <li class="page-item active"><span class="page-link">{{ request.GET.target }}</span></li>
            <li class="page-item"><a class="page-link" href="?{{ request.GET|GET_remove:"target"|GET_urlencode }}"><i class="fa fa-close"></i></a></li>
          </ul>
        </nav>
      </span>
    {% endif %}

  </div>

{% paginate 10 images %}
  <table class="table table-striped table-sm">
    <tr>
      <th>Id</th>
      <th>Time, UT</th>
      <th>Night</th>
      <th>Site</th>
      <th>CCD</th>
      <th>Filter</th>
      <th>Type</th>
      <th>Exposure</th>
      <th>Target</th>
      <th>RA</th>
      <th>Dec</th>
      <th>Preview</th>
      <!-- <th></th> -->
    </tr>
    {% for image in images %}
      <tr>
        <td><a href="{% url 'image_details' image.id %}" title="View image details"><i class="fa fa-file-image-o"></i> {{ image.id }}</a></td>
        <td>{{ image.time|date:"Y-m-d H:i:s" }}</td>

        {% with text="night="|addstr:image.night %}
          <td><a href="?{{ request.GET|GET_remove:"night"|GET_remove:"night1"|GET_remove:"night2"|GET_append:text|GET_urlencode }}">{{ image.night }}</a></td>
        {% endwith %}

        {% with text="site="|addstr:image.site %}
          <td><a href="?{{ request.GET|GET_remove:"site"|GET_append:text|GET_urlencode }}">{{ image.site }}</a></td>
        {% endwith %}

        <td>{{ image.ccd }} / {{ image.serial }}</td>

        {% with text="filter="|addstr:image.filter %}
          <td><a href="?{{ request.GET|GET_remove:"filter"|GET_append:text|GET_urlencode }}">{{ image.filter }}</a></td>
        {% endwith %}

        {% with text="type="|addstr:image.type %}
          <td><a href="?{{ request.GET|GET_remove:"type"|GET_append:text|GET_urlencode }}">{{ image.type }}</a></td>
        {% endwith %}

        <td>{{ image.exposure }}</td>

        {% with text="target="|addstr:image.target %}
          <td><a href="?{{ request.GET|GET_remove:"target"|GET_append:text|GET_urlencode }}">{{ image.target }}</a></td>
        {% endwith %}

        <td>{{ image.ra|floatformat:3 }}</td>
        <td>{{ image.dec|floatformat:3 }}</td>
        <td><a href="{% url 'image_details' image.id %}" title="View image details">
          <img src="{% url 'image_preview' image.id %}" class="img-thumbnail">
        </a></td>
        <!-- <td><a href="{% url 'image_download' image.id %}" title="Download FITS"><i class="fa fa-download"></i> </a></td> -->
      </tr>
    {% endfor %}
  </table>

  {% show_pages %}

{% endblock %}
